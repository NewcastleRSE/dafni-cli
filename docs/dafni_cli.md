# DAFNI CLI documentation

## Installation

The current method of distribution is via an executable program that can be run on the command line. This will take the form of a executable file called `dafni.exe`.
Due to this, there is no installation at this stage from a user perspective, just a necessity to have a copy of the executable on the computer it is to be used on.
___

## Commands

There are several commands implemented for the dafni CLI, these are listed below with there associated sub-commands and options.
___
### Login

>Command: `dafni(.exe) login`

This command, when completed will store the login JWT generated by the DAFNI API to the current working directory as `dafni_jwt.txt`.
When the login process is called, the initial step is to check the current working directory for a cached JWT file, if this isn't found then a prompt will be raised for the users user name and password to generate a new JWT token.
If however there is a stored JWT file found, the expiry datetime associated with the JWT will be checked to ensure it is still valid. If the token has not expired, then this will be used for any subsequent API calls, and prompts will not be required for the users user name and password. Otherwise the process to generate a new JWT will be started, and the current JWT file overwritten.
___
### Logout

>Command: `dafni(.exe) logout`

This command is used to remove any stored JWT files associated with the current users login session. If a JWT file exists, it will be removed and the users name and id will be printed to the command line for information. Otherwise a message informing the user that they are already logged out will be displayed.
___
### Get

>Command: `dafni(.exe) get [sub-command]`

Retrieve and display entities available to the user. 
If there is no valid JWT, the user will be prompted to login before the command is carried out.

**Sub-Commands:**
- Models:
  >*Command: `dafni(.exe) get models [options]`*

  Lists the models available to the user. 

  *Options*:
  - **--creation-date**: Filter to only show the models created since a given date with format DD/MM/YYYY.
  - **--publication-date**:  Filter to only show the models created since a given date with format DD/MM/YYYY.
  - **--long/--short**: If `--long` added as an option, the description of each model will be returned as well as the regular information.
    If `--short` is chosen, only the name, version ID, creation date and summary will be displayed. Default: `--short`.
  
  Example output:
  <pre>
  Name: Model 1     ID: abc10-ab20-3abc-12345678a1b2      Date: January 1st 2020
  Summary: This is a summary of the model.
  Name: Model 2     ID: xyz10-xy20-3xyz-12345678x1y2      Date: January 1st 2020
  Summary: This is a summary of another model.
  </pre>

- Model:
  >*Command: `dafni(.exe) get model [version_id] [options]`*
  
  Displays the metadata or version history for one or more model(s).
  
  *Arguments*:
  - **version_id**: Version of the model to display the metadata of.
  Multiple version IDs can be specified and the metadata of each model will be displayed in sequence.
  
  *Options*:
  - **--version-history/--metadata**: If `--version-history` is added as an option, the name, version ID, publication date and version message of each version of the model will be displayed in reverse chronological order.
    If `--metadata` is chosen, the metadata for that version of the model is displayed.
    Default: `--metadata`. 
  
  Example outputs:
  <pre>
  Name: Model 1
  Date: January 1st 2020
  Summary:
  This is a summary of the model.
  Description:
  This is a longer description of the model, perhaps touching on more details 
  and other things. It uses text wrapping to be more readable.
  
  Input Parameters:
  Title       Type       Min    Max    Default  Description
  --------------------------------------------------------------------
  param1      integer    1      10     1        A fancy parameter
  param2      string                   normal   A fancy setting
  
  Input Data Slots:
  Name: Input file
  Path in container: inputs/
  Required: True
  Default Datasets:
  Name: Dataset 1    ID: xyz09-xy09-8xyz-87654321x9y8   Version ID: xyz09-xy09-8xyz-56843975x9y8
  
  Outputs:
  Name                                     Format    Summary
  a_very_big_table_of_results.csv          CSV       The results you care about
  another_very_big_table_of_results.csv    CSV       Some extra results you may find useful
  </pre>
  
  With `--version-history`.
  <pre>
  Name: New Model 1     ID: abc10-ab20-3abc-12345678a1b2     Date: January 1st 2020
  Version message: New version
  Version tags: latest, new parameter
  
  Name: Model 1     ID: aaa10-ab20-3abc-12345678a1b2     Date: December 31st 2019
  Version message: Original version
  Version tags: 
  </pre>

- Datasets:
  >*Command: `dafni(.exe) get datasets [options]`*

  Lists the datasets available to the user. 
  
  *Note*: If a date range filter is applied, the default behavior is to omit any datasets that don't have a date range set. This is in part due to a bug with the discovery api (https://github.com/dafnifacility/user-feedback/issues/72) which means we can't use this filter without a search term.
  
  *Options*:
  - **--search**: Option to apply a text search to the available datasets.
  - **--start-date**:  Filter to only show the datasets with a date range since a given date with format DD/MM/YYYY.
  - **--end-date**: Filter to only show the datasets with a date range before a given date with format DD/MM/YYYY.
  
  Example output:
  <pre>
  Title: Example Dataset
  ID: xyz09-xy09-8xyz-87654321x9y8
  Latest Version: xyz09-xy09-8xyz-56843975x9y8
  Publisher: DAFNI
  From: March 27 2011    To: March 27 2021
  Description:
  Verbose description of the dataset
  </pre>